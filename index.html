<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distance Matrix Utilities • usedist</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Distance Matrix Utilities">
<meta property="og:description" content="Functions to re-arrange, extract, and work with distances.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">usedist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="usedist">usedist<a class="anchor" aria-label="anchor" href="#usedist"></a>
</h1></div>
<p>This package provides useful functions for distance matrix objects in R.</p>
<p><a href="https://travis-ci.org/kylebittinger/usedist" class="external-link"><img src="https://travis-ci.org/kylebittinger/usedist.svg?branch=master" alt="Travis-CI Build Status"></a></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install usedist from github with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"kylebittinger/usedist"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction-to-distance-matrices-in-r">Introduction to distance matrices in R<a class="anchor" aria-label="anchor" href="#introduction-to-distance-matrices-in-r"></a>
</h2>
<p>In R, the <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist()</a></code> function is used to compute a distance matrix. But the result you get back isn’t really a matrix, it’s a <code>"dist"</code> object. Under the hood, the <code>"dist"</code> object is stored as a simple vector. When it’s printed out, R knows how to make it look like a matrix. Let’s make a distance object representing the distances between six rows of data.</p>
<p>Here is our data matrix, <code>X</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span></span>
<span><span class="va">X</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">##         [,1]         [,2]       [,3]       [,4]        [,5]</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">## A  1.2629543 -0.928567035 -1.1476570  0.4356833 -0.05710677</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">## B -0.3262334 -0.294720447 -0.2894616 -1.2375384  0.50360797</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">## C  1.3297993 -0.005767173 -0.2992151 -0.2242679  1.08576936</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">## D  1.2724293  2.404653389 -0.4115108  0.3773956 -0.69095384</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">## E  0.4146414  0.763593461  0.2522234  0.1333364 -1.28459935</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">## F -1.5399500 -0.799009249 -0.8919211  0.8041895  0.04672617</span></span></code></pre></div>
<p>And here is our <code>"dist"</code> object, <code>d</code>, representing the distance between rows of <code>X</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">d</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">##          A        B        C        D        E</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">## B 2.603430                                    </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">## C 1.821423 2.047355                           </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">## D 3.472394 3.727228 3.056922                  </span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">## E 2.672239 2.653173 2.734967 2.069155         </span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">## F 2.843420 2.543180 3.369470 4.373791 3.129488</span></span></code></pre></div>
<p>These <code>"dist"</code> objects are great, but R does not provide a set of functions to work with them conveniently. That’s where the <code>usedist</code> package comes in.</p>
</div>
<div class="section level2">
<h2 id="working-with-dist-objects">Working with “dist” objects<a class="anchor" aria-label="anchor" href="#working-with-dist-objects"></a>
</h2>
<p>The <code>usedist</code> package provides some basic functions for altering or selecting distances from a <code>"dist"</code> object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">usedist</span><span class="op">)</span></span></code></pre></div>
<p>To start, we can make a new <code>"dist"</code> object, containing the distances between rows B, C, F, and D. Our new object contains the rows <em>in the order we specified</em>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dist_subset.html">dist_subset</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"F"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">##          B        C        F</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">## C 2.047355                  </span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">## F 2.543180 3.369470         </span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">## D 3.727228 3.056922 4.373791</span></span></code></pre></div>
<p>This is especially helpful when arranging a distance matrix to match a data frame, for instance with the <code>adonis()</code> function in <code>vegan</code>.</p>
<p>We can extract distances between specified pairs of rows. For example, we’ll pull out the distances for rows A-to-D, B-to-E, and C-to-F. To extract specific distance values, we use <code><a href="reference/dist_get.html">dist_get()</a></code>. This function takes two vectors of row labels: one vector for the rows of origin, and another for the rows of destination.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">origin_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">destination_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/dist_get.html">dist_get</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">origin_row</span>, <span class="va">destination_row</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">## [1] 3.472394 2.653173 3.369470</span></span></code></pre></div>
<p>If rows are arranged in groups, we might like to have a data frame listing the distances alongside the groups for each pair of rows. The <code><a href="reference/dist_groups.html">dist_groups()</a></code> function makes a data frame from the groups, and also adds in a nice label that you might use for plots.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">item_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Treatment"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/dist_groups.html">dist_groups</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">item_groups</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">##    Item1 Item2    Group1    Group2                         Label Distance</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">## 1      A     B   Control   Control                Within Control 2.603430</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">## 2      A     C   Control   Control                Within Control 1.821423</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">## 3      A     D   Control Treatment Between Control and Treatment 3.472394</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">## 4      A     E   Control Treatment Between Control and Treatment 2.672239</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">## 5      A     F   Control Treatment Between Control and Treatment 2.843420</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">## 6      B     C   Control   Control                Within Control 2.047355</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">## 7      B     D   Control Treatment Between Control and Treatment 3.727228</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">## 8      B     E   Control Treatment Between Control and Treatment 2.653173</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">## 9      B     F   Control Treatment Between Control and Treatment 2.543180</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">## 10     C     D   Control Treatment Between Control and Treatment 3.056922</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">## 11     C     E   Control Treatment Between Control and Treatment 2.734967</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co">## 12     C     F   Control Treatment Between Control and Treatment 3.369470</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">## 13     D     E Treatment Treatment              Within Treatment 2.069155</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="co">## 14     D     F Treatment Treatment              Within Treatment 4.373791</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co">## 15     E     F Treatment Treatment              Within Treatment 3.129488</span></span></code></pre></div>
<p>You might have your own distance function that you’d like to use, beyond the options available in <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist()</a></code> or <code>vegan::vegdist()</code>. For example, the RMS distance is kind of like the Euclidean distance, but you take the mean of the squared differences instead of the sum inside the square root. Let’s define the distance function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rms_distance</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">r1</span>, <span class="va">r2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">r2</span><span class="op">-</span> <span class="va">r1</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then, we can pass it to <code><a href="reference/dist_make.html">dist_make()</a></code> to create a new distance matrix of RMS distances.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dist_make.html">dist_make</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">rms_distance</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">##           A         B         C         D         E</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">## B 1.1642895                                        </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">## C 0.8145653 0.9156050                              </span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">## D 1.5529017 1.6668670 1.3670972                    </span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">## E 1.1950614 1.1865353 1.2231143 0.9253541          </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">## F 1.2716160 1.1373449 1.5068729 1.9560190 1.3995495</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="centroid-functions">Centroid functions<a class="anchor" aria-label="anchor" href="#centroid-functions"></a>
</h2>
<p>The <code>usedist</code> package contains functions for computing the distance to group centroid positions. This is accomplished without finding the location of the centroids themselves, though it is assumed that some high-dimensional Euclidean space exists where the centroids can be situated. References for the formulas used can be found in the function documentation.</p>
<p>To illustrate, let’s create a set of points in 2-dimensional space. Four points will be centered around the origin, and four around the point (3, 0).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  Item <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>,</span>
<span>  Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Treatment"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pts</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="va">Item</span><span class="op">)</span>, hjust<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tools/readme/centroid_example-1.png"><!-- --></p>
<p>Our goal is to figure out distances for the group centroids using only the distances between points. First, we need to put the data in matrix format.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pts</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pts_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">pts</span><span class="op">$</span><span class="va">Item</span></span></code></pre></div>
<p>Now, we’ll compute the point-to-point distances with <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts_distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">pts_matrix</span><span class="op">)</span></span>
<span><span class="va">pts_distances</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co">##          A        B        C        D        E        F        G</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co">## B 1.414214                                                      </span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co">## C 1.414214 2.000000                                             </span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">## D 2.000000 1.414214 1.414214                                    </span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co">## E 3.000000 2.236068 2.236068 1.000000                           </span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co">## F 4.123106 3.000000 3.605551 2.236068 1.414214                  </span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co">## G 4.123106 3.605551 3.000000 2.236068 1.414214 2.000000         </span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co">## H 5.000000 4.123106 4.123106 3.000000 2.000000 1.414214 1.414214</span></span></code></pre></div>
<p>The function <code><a href="reference/dist_between_centroids.html">dist_between_centroids()</a></code> will calculate the distance between the centroids of the two groups. Here, we expect to get a distance of 3.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dist_between_centroids.html">dist_between_centroids</a></span><span class="op">(</span></span>
<span>  <span class="va">pts_distances</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">## [1] 3</span></span></code></pre></div>
<p>The function is only using the distance matrix; it doesn’t know where the individual points are in space.</p>
<p>We can use another function, <code><a href="reference/dist_to_centroids.html">dist_to_centroids()</a></code>, to calculate the distance from each individual point to the group centroids. Again, this works without knowing the point locations, only the distances between points. In our example, the distances within the Control group and within the Treatment group should all be equal to 1.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dist_to_centroids.html">dist_to_centroids</a></span><span class="op">(</span><span class="va">pts_distances</span>, <span class="va">pts</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">##    Item CentroidGroup CentroidDistance</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co">## 1     A       Control         1.000000</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="co">## 2     B       Control         1.000000</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co">## 3     C       Control         1.000000</span></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="co">## 4     D       Control         1.000000</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="co">## 5     E       Control         2.000000</span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co">## 6     F       Control         3.162278</span></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="co">## 7     G       Control         3.162278</span></span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="co">## 8     H       Control         4.000000</span></span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="co">## 9     A     Treatment         4.000000</span></span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="co">## 10    B     Treatment         3.162278</span></span>
<span id="cb24-12"><a href="#cb24-12"></a><span class="co">## 11    C     Treatment         3.162278</span></span>
<span id="cb24-13"><a href="#cb24-13"></a><span class="co">## 12    D     Treatment         2.000000</span></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="co">## 13    E     Treatment         1.000000</span></span>
<span id="cb24-15"><a href="#cb24-15"></a><span class="co">## 14    F     Treatment         1.000000</span></span>
<span id="cb24-16"><a href="#cb24-16"></a><span class="co">## 15    G     Treatment         1.000000</span></span>
<span id="cb24-17"><a href="#cb24-17"></a><span class="co">## 16    H     Treatment         1.000000</span></span></code></pre></div>
<p>You can use the Pythagorean theorem to check that the other distances are correct. The distance between point “G” and the centroid for the <em>Control</em> group should be sqrt(3<sup>2</sup> + 1<sup>2</sup>) = sqrt(10) = 3.162278.</p>
</div>
<div class="section level2">
<h2 id="long-format-data">Long format data<a class="anchor" aria-label="anchor" href="#long-format-data"></a>
</h2>
<p>Many times, the data is not stored as a matrix, but is represented in “long” format as a data frame. In this case, one column of the data frame gives the row label for the matrix, another indicates the column label, and a third provides the value. To get a real data matrix, we have to “pivot” the data frame and convert to matrix form. Because this is such a common operation, <code>usedist</code> includes a convenience function, <code><a href="reference/pivot_to_matrix.html">pivot_to_matrix()</a></code>.</p>
<p>Here is an example of data in long format:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  row_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"C"</span><span class="op">)</span>,</span>
<span>  column_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_long</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co">##   row_id column_id value</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co">## 1      A         x    11</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co">## 2      A         y    10</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co">## 3      A         z    10</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">## 4      B         x     9</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">## 5      B         y     7</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">## 6      C         y    15</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">## 7      C         z    10</span></span></code></pre></div>
<p>The data table has no value for row “B” and column “z”. By default, a value of 0 is filled in for missing combinations when we convert to matrix format. Here is how we convert:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pivot_to_matrix.html">pivot_to_matrix</a></span><span class="op">(</span><span class="va">data_long</span>, <span class="va">row_id</span>, <span class="va">column_id</span>, <span class="va">value</span><span class="op">)</span></span>
<span><span class="va">data_matrix</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">##    x  y  z</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">## A 11 10 10</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co">## B  9  7  0</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co">## C  0 15 10</span></span></code></pre></div>
<p>Note that we provide bare column names in the call to <code><a href="reference/pivot_to_matrix.html">pivot_to_matrix()</a></code>. This function requires some extra packages to be installed. They are listed as suggestions for <code>usedist</code>. If the additional packages are not installed on your system, you’ll get an error message with the missing packages listed.</p>
<p>The matrix format is what we need for distance calculations. If you want to convert from long format and use a custom distance function, you can combine <code><a href="reference/pivot_to_matrix.html">pivot_to_matrix()</a></code> with <code><a href="reference/dist_make.html">dist_make()</a></code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dist_make.html">dist_make</a></span><span class="op">(</span><span class="va">data_matrix</span>, <span class="va">rms_distance</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">##          A        B</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="co">## B 6.137318         </span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co">## C 6.976150 9.036961</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parallelization">Parallelization<a class="anchor" aria-label="anchor" href="#parallelization"></a>
</h2>
<p>Distance calculations can get computationally expensive with large sample sizes. With the installation of future.apply package, you cna compute the distances in parallel to save time.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co">## Loading required package: future</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/dist_make.html">dist_make</a></span><span class="op">(</span><span class="va">data_matrix</span>, <span class="va">rms_distance</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">##          A        B</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co">## B 6.137318         </span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="co">## C 6.976150 9.036961</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=usedist" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing usedist</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kyle Bittinger <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Kyle Bittinger.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
